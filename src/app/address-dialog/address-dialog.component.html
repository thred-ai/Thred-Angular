<!-- <div mat-dialog-title>Install App</div> -->

<div class="p-0 h-100 w-100 my-3">
  <div class="w-100 h-100 d-flex justify-content-between flex-column">
    <div
      class="w-100 h-100 d-flex justify-content-center align-content-center"
      *ngIf="mode == 0"
    >
      <div class="w-100 px-3 h-100">
        <div
          class="w-100 mb-5 mt-3 mt-md-2 d-none d-md-block"
          style="height: 60px; pointer-events: none"
        >
          <div
            class="h-100 d-flex justify-content-start align-items-center my-auto w-100"
          >
            <div
              class="h-100 rounded-15 shadow bg-white"
              style="aspect-ratio: 1"
            >
              <img
                class="rounded-15 w-100 h-100"
                style="object-fit: contain"
                [src]="item.displayUrls[0]"
                role="button"
              />
            </div>

            <div
              class="px-3 text-start h-100 d-flex justify-content-center align-content-center w-75"
            >
              <div class="w-100 my-auto text-truncate">
                <span class="fw-bolder my-0 mx-0" style="font-size: 16px">{{
                  item.name
                }}</span>
                <div
                  class="d-flex justify-content-start align-items-center mt-0"
                >
                  <span
                    class="fw-bold text-purple text-truncate mw-100"
                    style="font-size: 12.5px"
                    >{{ item.creatorName }}</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        <h3 class="w-100 fw-bold mb-4" style="font-size: 20px">Network</h3>
        <div class="rounded-pill border w-100 pb-2 px-4 mb-4">
          <mat-form-field class="w-100" appearance="legacy" floatLabel="never">
            <mat-select
              [(ngModel)]="selectedChain"
              (selectionChange)="changed($event)"
              class="my-auto"
              panelClass="rounded-panel"
            >
              <mat-select-trigger class="text-dark">
                <div
                  class="w-100 d-flex justify-content-start align-items-center"
                  style="height: 22.5px"
                >
                  <img
                    id="image"
                    *ngIf="selectedChain?.url"
                    class="me-2 h-100"
                    [src]="selectedChain?.url"
                    style="object-fit: cover; aspect-ratio: 1"
                  />
                  <span class="py-1" style="font-size: medium">
                    {{ selectedChain?.name ?? "No Network Selected" }}
                  </span>
                </div>
              </mat-select-trigger>

              <mat-option
                *ngFor="let chain of item.chains ?? []"
                [value]="chain"
              >
                <div
                  class="w-100 d-flex justify-content-start align-items-center"
                  style="height: 22.5px"
                >
                  <img
                    id="image"
                    *ngIf="chain?.url"
                    class="me-2 h-100"
                    [src]="chain?.url"
                    style="object-fit: cover; aspect-ratio: 1"
                  />
                  <span class="py-1" style="font-size: medium">
                    {{ chain?.name ?? "No Network Selected" }}
                  </span>
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- <h3 class="w-100 fw-bold mb-4" style="font-size: 20px">
          Install Locations
        </h3> 
        
        <div
          class="rounded-pill border w-100 pb-2 px-4 mb-3"
          *ngIf="15 as threshold"
        >
          <mat-form-field class="w-100" appearance="legacy" floatLabel="never">
            <mat-chip-list #chipList aria-label="Product selection">
              <ng-container
                *ngFor="let address of selectedAddresses ?? []; index as i"
              >
                <ng-container
                  *ngIf="
                    (address | addressValidate) ? 'y' : 'n' as validAddress
                  "
                >
                  <ng-container
                    *ngIf="
                      (
                        selectedChain?.id == 1
                          ? validAddress == 'y'
                            ? validAddress == 'y'
                            : (address | nameEnsLookup | async)
                          : validAddress == 'y'
                      )
                        ? 'y'
                        : 'n' as result
                    "
                  >
                    <mat-chip
                      [selectable]="selectable"
                      class="bg-{{
                        result == 'y' ? 'light-success' : 'light-danger'
                      }} close-{{ i }}"
                      [mdbPopover]="template"
                      placement="right"
                      trigger="click"
                      style="cursor: pointer"
                      *ngIf="
                        address
                          | address
                            : false
                            : address.length > threshold as displayAddress
                      "
                    >
                      <div class="category-chip__text text-white">
                        {{ displayAddress }}
                      </div>
                      <div
                        matChipRemove
                        class="d-flex justify-content-center align-items-center btn me-1 rounded-circle bg-{{
                          result == 'y' ? 'light-success' : 'light-danger'
                        }} text-white fw-bolder"
                        style="
                          width: fit-content;
                          aspect-ratio: 1/1;
                          opacity: 1;
                          pointer-events: none;
                        "
                      >
                        <mat-icon>
                          {{ result == "y" ? "check_circle" : "error" }}
                        </mat-icon>
                      </div>
                      <ng-template #template>
                        <div
                          class="w-100 h-100 popover-menu menu-{{
                            i
                          }} popover-body-padding"
                        >
                          <ng-container *ngIf="result == 'y'">
                            <b class="fw-bolder mb-4 text-light-success"
                              >Verified Address</b
                            >
                            <br />
                            The App will be installed on this address.
                          </ng-container>
                          <ng-container *ngIf="result != 'y'">
                            <b class="fw-bolder mb-4 text-light-danger"
                              >Invalid Address</b
                            >
                            <br />
                            The App will not be installed on this address.
                          </ng-container>
                          <br />
                          <div class="w-100 h-100 mt-3">
                            <button
                              (click)="remove(address, result == 'y')"
                              id="removeBtn"
                              class="w-100 btn bg-black text-white fw-bold rounded-10 px-4 py-2"
                            >
                              Remove
                            </button>
                          </div>
                        </div>
                      </ng-template>
                    </mat-chip>
                  </ng-container>
                </ng-container>
              </ng-container>

              <input
                class="h-100 text-dark"
                [placeholder]="
                  selectedChain?.id == 1 ? 'Ex. thred.eth' : 'Ex. 0x56...78'
                "
                #addressInput
                [formControl]="addressCtrl"
                [matAutocomplete]="auto"
                [matChipInputFor]="chipList"
                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                (matChipInputTokenEnd)="add($event)"
                [disabled]="true"
              />

            </mat-chip-list>
            <mat-autocomplete
              #auto="matAutocomplete"
              (optionSelected)="selected($event)"
            >
              <cdk-virtual-scroll-viewport
                class="autocomplete-test-viewport"
                [ngStyle]="{
                  height:
                    ((filteredAddresses | async) ?? []).length > 0
                      ? '150px'
                      : '0px'
                }"
                itemSize="35"
              >
                <mat-option
                  *cdkVirtualFor="let address of filteredAddresses | async"
                  [value]="address"
                >
                  <ng-container
                    *ngIf="
                      address
                        | address
                          : false
                          : address.length > threshold as displayAddress
                    "
                  >
                    <div
                      class="d-flex justify-content-start align-items-center w-100"
                    >
                      {{ displayAddress }}
                    </div>
                  </ng-container>
                </mat-option>
              </cdk-virtual-scroll-viewport>
            </mat-autocomplete>
          </mat-form-field>
        </div> -->

        <div class="w-100 py-3" *ngIf="item.etherPrice | formatEther as price">
          <div
            class="w-100 d-flex justify-content-between align-content-center px-1"
          >
            <ng-container *ngIf="' ' + selectedChain?.currency as currency">
              <span>
                1 x
                {{ price + currency }}
              </span>

              <span class="fw-bold">
                {{
                  ((price | numberType) ?? 0) > 0
                    ? ((price | numberType) ?? 0) + currency
                    : "Free"
                }}
              </span>
            </ng-container>
          </div>
        </div>

        <button
          class="btn bg-{{
            loading == 3 ? 'light-success' : loading == 4 ? 'danger' : 'purple'
          }} text-white rounded-pill px-5 py-3 my-3 mt-3 fw-bold w-100"
          role="button"
          [disabled]="loading > 0"
          (click)="complete()"
        >
          {{
            loading == 0
              ? "Install"
              : loading == 1
              ? "Verifying"
              : loading == 2
              ? "Installing"
              : loading == 3
              ? "Installed"
              : "Install Failed"
          }}
          <span
            *ngIf="loading > 0 && loading < 3"
            class="spinner-border spinner-border-sm ms-1"
            role="status"
            aria-hidden="true"
          ></span>
        </button>
      </div>
    </div>
    <div class="w-100 p-2" *ngIf="mode == 1">
      <h3 class="w-100 fw-bold mb-4" style="font-size: 20px">Connect Wallet</h3>
      <div class="rounded-15 w-100 border" style="overflow: hidden">
        <app-wallet-connect-component
          [providers]="['metamask', 'wallet-connect']"
          (selected)="selectedProvider($event)"
        >
        </app-wallet-connect-component>
      </div>
    </div>
  </div>
</div>
