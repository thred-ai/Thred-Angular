<div
  *ngIf="editableLayout"
  class="bg-light p-0 {{
    editable ? 'big-design-card shadow w-100 h-100' : 'vh-75 vw-50'
  }}"
  style="overflow: hidden"
>
  <mat-tab-group
    class="{{ editable ? 'w-100 h-100' : 'vh-75' }} remove-border-bottom"
    animationDuration="0"
    #tabGroup
    [color]="color"
  >
    <mat-tab
      class="py-0"
      *ngFor="
        let page of editableLayout.pages ?? [];
        index as p;
        trackBy: trackByIndex
      "
    >
      <ng-template mat-tab-label>
        <div
          (cdkDropListDropped)="onDropTab($event)"
          [cdkDropListConnectedTo]="(childMenuIds$ | async)!"
          [cdkDropListData]="editableLayout.pages"
          [id]="CHILD_ID_NAME + p"
          [cdkDropListOrientation]="'horizontal'"
          class="w-100 child-menu-drop-list"
          cdkDropList
          *ngIf="editable"
        >
          <div
            (cdkDragEntered)="onDragEntered($event)"
            (cdkDragExited)="onDragExited($event)"
            class="d-flex align-items-center bg-light ps-2 rounded fw-bold zoom"
            cdkDrag
            style="font-size: small"
          >
            <div *cdkDragPlaceholder class="drag-custom-placeholder"></div>
            <div
              class="drag-wrapper d-flex w-100 justify-content-between align-content-center p-1"
            >
              <div class="d-flex align-items-center">
                <span>{{ page.title }}</span>
              </div>

              <div class="d-flex justify-content-between align-content-center">
                <button
                  (click)="onRemoveMenu($event, p)"
                  [disabled]="editableLayout.pages.length === 1"
                  class="text-purple fw-bolder"
                  mat-icon-button
                >
                  <mat-icon class="text">clear</mat-icon>
                </button>
                <div
                  class="bg-light-gray my-auto"
                  style="width: 1px; height: 60%"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
      <div
        class="w-100 h-100 d-block d-md-flex justify-content-between align-items-top border-{{
          editable ? 'top' : 'none'
        }}"
      >
        <div
          class="d-none d-md-block w-100 w-md-20 h-100 big-design-card rounded-0 bg-white shadow-0 p-0 border-end"
          *ngIf="editable"
        >
          <div class="h-100 w-100 py-2">
            <div class="h-100 w-100" id="label">
              <div
                *ngIf="editingBlock == undefined"
                class="w-100 h-100"
                style="overflow-y: scroll"
              >
                <mat-accordion class="example-headers-align" multi>
                  <mat-expansion-panel
                    class="shadow-0 border-bottom"
                    [expanded]="true"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title class="fw-bold text-dark">
                        General
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Name</p>

                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 pb-2 px-4 mb-4">
                          <mat-form-field
                            class="w-100 text"
                            appearance="legacy"
                            floatLabel="never"
                          >
                            <input
                              matInput
                              class="bg-transparent text-truncate"
                              type="text"
                              name="name"
                              [(ngModel)]="page.title"
                              placeholder="Name"
                            />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Position</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 pe-4 mb-3">
                          <mat-form-field
                            class="w-100 text"
                            appearance="legacy"
                            floatLabel="never"
                          >
                            <mat-select
                              [(ngModel)]="page.position"
                              (selectionChange)="changed(undefined, $event)"
                              class="my-auto d-flex justify-content-start align-items-center"
                            >
                              <mat-select-trigger
                                class="text-dark h-100 m-auto"
                                *ngIf="matchingTabType(page.position ?? 0)"
                              >
                                <div
                                  class="w-100 d-flex justify-content-start align-items-center p-3 my-auto"
                                >
                                  <div style="height: 40px"></div>
                                  <div
                                    class="text-start text-truncate w-50 ms-2"
                                  >
                                    {{ matchingTabType(page.position)!.name }}
                                  </div>
                                </div>
                              </mat-select-trigger>

                              <mat-option
                                *ngFor="let type of tabPosTypes ?? []"
                                [value]="type.code"
                              >
                                <div
                                  class="h-100 w-100 d-flex justify-content-start justify-content-md-between align-items-center py-3"
                                >
                                  <div
                                    class="d-flex justify-content-start align-items-center"
                                  >
                                    <span
                                      class="py-1"
                                      style="font-size: medium"
                                    >
                                      {{ type?.name ?? "Choose a block type" }}
                                    </span>
                                  </div>
                                </div>
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Background Color</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 px-2 mb-3">
                          <a
                            role="button"
                            class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                            [cpPosition]="'bottom'"
                            [cpPositionRelativeToArrow]="false"
                            (colorPickerSelect)="
                              editableLayout!.pages[p]!.backgroundColor =
                                $event;
                              syncBlockAndPageColors(p, $event)
                            "
                            [cpOutputFormat]="'hex'"
                            [cpOKButton]="true"
                            [cpOKButtonText]="'SET COLOR'"
                            [cpOKButtonClass]="'big-design-alt-button'"
                            [cpSaveClickOutside]="false"
                            [colorPicker]="page.backgroundColor ?? '#FFFFFF'"
                            style="height: 40px"
                          >
                            <p
                              class="big-design-input-text my-auto p-0"
                              style="font-size: 14px"
                            >
                              {{ page.backgroundColor }}
                            </p>
                            <div
                              class="rounded-circle border border-secondary"
                              style="height: 20px; aspect-ratio: 1"
                              [style.background-color]="
                                page.backgroundColor ?? '#FFFFFF'
                              "
                            ></div>
                          </a>
                        </div>
                      </div>
                    </div>

                    <div
                      class="w-100 pt-3 pb-0 text-purple text-center fw-bold"
                    >
                      <i><span style="font-size: small">General</span></i>
                    </div>
                  </mat-expansion-panel>

                  <mat-expansion-panel class="shadow-0 border-bottom">
                    <mat-expansion-panel-header>
                      <mat-panel-title class="fw-bold text-dark">
                        Navigation Bar
                      </mat-panel-title>
                    </mat-expansion-panel-header>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Availability</p>
                      <mat-slide-toggle
                        class="mb-3"
                        [(ngModel)]="page.bar.visible"
                      >
                        {{ page.bar.visible ? "Visible" : "Hidden" }}
                      </mat-slide-toggle>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Content Type</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 pe-4 mb-3">
                          <mat-form-field
                            class="w-100 text"
                            appearance="legacy"
                            floatLabel="never"
                          >
                            <mat-select
                              [(ngModel)]="page.bar.mode"
                              (selectionChange)="changed(undefined, $event)"
                              class="my-auto d-flex justify-content-start align-items-center"
                            >
                              <mat-select-trigger
                                class="text-dark h-100 m-auto"
                                *ngIf="matchingBarType(page.bar.mode ?? 0)"
                              >
                                <div
                                  class="w-100 d-flex justify-content-start align-items-center p-3 my-auto"
                                >
                                  <div style="height: 40px"></div>
                                  <div
                                    class="text-start text-truncate w-50 ms-2"
                                  >
                                    {{ matchingBarType(page.bar.mode)!.name }}
                                  </div>
                                </div>
                              </mat-select-trigger>

                              <mat-option
                                *ngFor="let type of navBarTypes ?? []"
                                [value]="type.code"
                              >
                                <div
                                  class="h-100 w-100 d-flex justify-content-start justify-content-md-between align-items-center py-3"
                                >
                                  <div
                                    class="d-flex justify-content-start align-items-center"
                                  >
                                    <span
                                      class="py-1"
                                      style="font-size: medium"
                                    >
                                      {{
                                        type?.name ?? "Choose a content type"
                                      }}
                                    </span>
                                  </div>
                                </div>
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Bar Color</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 px-2 mb-3">
                          <a
                            role="button"
                            class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                            [cpPosition]="'bottom'"
                            [cpPositionRelativeToArrow]="false"
                            (colorPickerSelect)="
                              page.bar.backgroundColor = $event
                            "
                            [cpOutputFormat]="'hex'"
                            [cpOKButton]="true"
                            [cpOKButtonText]="'SET COLOR'"
                            [cpOKButtonClass]="'big-design-alt-button'"
                            [cpSaveClickOutside]="false"
                            [colorPicker]="page.bar.backgroundColor"
                            style="height: 40px"
                          >
                            <p
                              class="big-design-input-text my-auto p-0"
                              style="font-size: 14px"
                            >
                              {{ page.bar.backgroundColor }}
                            </p>
                            <div
                              class="rounded-circle border border-secondary"
                              style="height: 20px; aspect-ratio: 1"
                              [style.background-color]="
                                page.bar.backgroundColor
                              "
                            ></div>
                          </a>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Bar Text Color</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 px-2 mb-3">
                          <a
                            role="button"
                            class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                            [cpPosition]="'bottom'"
                            [cpPositionRelativeToArrow]="false"
                            (colorPickerSelect)="page.bar.textColor = $event"
                            [cpOutputFormat]="'hex'"
                            [cpOKButton]="true"
                            [cpOKButtonText]="'SET COLOR'"
                            [cpOKButtonClass]="'big-design-alt-button'"
                            [cpSaveClickOutside]="false"
                            [colorPicker]="page.bar.textColor"
                            style="height: 40px"
                          >
                            <p
                              class="big-design-input-text my-auto p-0"
                              style="font-size: 14px"
                            >
                              {{ page.bar.textColor }}
                            </p>
                            <div
                              class="rounded-circle border border-secondary"
                              style="height: 20px; aspect-ratio: 1"
                              [style.background-color]="page.bar.textColor"
                            ></div>
                          </a>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Bar Detail Color</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 px-2 mb-3">
                          <a
                            role="button"
                            class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                            [cpPosition]="'bottom'"
                            [cpPositionRelativeToArrow]="false"
                            (colorPickerSelect)="page.bar.detailColor = $event"
                            [cpOutputFormat]="'hex'"
                            [cpOKButton]="true"
                            [cpOKButtonText]="'SET COLOR'"
                            [cpOKButtonClass]="'big-design-alt-button'"
                            [cpSaveClickOutside]="false"
                            [colorPicker]="page.bar.detailColor"
                            style="height: 40px"
                          >
                            <p
                              class="big-design-input-text my-auto p-0"
                              style="font-size: 14px"
                            >
                              {{ page.bar.detailColor }}
                            </p>
                            <div
                              class="rounded-circle border border-secondary"
                              style="height: 20px; aspect-ratio: 1"
                              [style.background-color]="page.bar.detailColor"
                            ></div>
                          </a>
                        </div>
                      </div>
                    </div>

                    <div
                      class="w-100 pt-3 pb-0 text-purple text-center fw-bold"
                    >
                      <i
                        ><span style="font-size: small">Navigation Bar</span></i
                      >
                    </div>
                  </mat-expansion-panel>

                  <mat-expansion-panel class="shadow-0 border-bottom">
                    <mat-expansion-panel-header>
                      <mat-panel-title class="fw-bold text-dark">
                        Tab Bar
                      </mat-panel-title>
                    </mat-expansion-panel-header>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Tab Icon</p>

                      <div class="px-3 w-100">
                        <div
                          class="rounded-pill border w-100 py-0 px-3 ps-4 mb-4"
                        >
                          <mat-form-field
                            class="w-100 text h-100 py-0"
                            appearance="legacy"
                            floatLabel="never"
                          >
                            <input
                              type="text"
                              placeholder="Tab Icon"
                              class="bg-transparent text-truncate mb-2"
                              matInput
                              [ngModel]="page.icon"
                              (ngModelChange)="filterCodes($event)"
                              [matAutocomplete]="auto"
                            />

                            <mat-autocomplete
                              #auto="matAutocomplete"
                              [displayWith]="formattedName.bind(this)"
                            >
                              <cdk-virtual-scroll-viewport
                                class="autocomplete-test-viewport"
                                [ngStyle]="{ height: height }"
                                itemSize="35"
                              >
                                <mat-optgroup
                                  style="display: block"
                                  *cdkVirtualFor="
                                    let iconGroup of filteredIcons | async
                                  "
                                  [label]="iconGroup.category | uppercase"
                                >
                                  <mat-option
                                    class="not-empty-select autocomplete-item"
                                    *ngFor="let icon of iconGroup.icons"
                                    [value]="icon"
                                    (click)="selectIcon(icon, page)"
                                  >
                                    <mat-icon class="me-2 my-auto">{{
                                      icon
                                    }}</mat-icon>
                                    {{ formattedName(icon) | titlecase }}
                                  </mat-option>
                                  <!-- [selected]="icon == theme" -->
                                </mat-optgroup>
                              </cdk-virtual-scroll-viewport>

                              <!-- <mat-option
                                *ngFor="let feeCode of filteredFeeCodes | async"
                                [value]="feeCode.code"
                                >{{ feeCode.code }}
                              </mat-option> -->
                            </mat-autocomplete>

                            <div matSuffix>
                              <mat-icon class="pb-2 me-1">{{
                                page.icon
                              }}</mat-icon>
                            </div>
                          </mat-form-field>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Bar Color</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 px-2 mb-3">
                          <a
                            role="button"
                            class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                            [cpPosition]="'bottom'"
                            [cpPositionRelativeToArrow]="false"
                            (colorPickerSelect)="
                              page.tab.backgroundColor = $event
                            "
                            [cpOutputFormat]="'hex'"
                            [cpOKButton]="true"
                            [cpOKButtonText]="'SET COLOR'"
                            [cpOKButtonClass]="'big-design-alt-button'"
                            [cpSaveClickOutside]="false"
                            [colorPicker]="page.tab.backgroundColor"
                            style="height: 40px"
                          >
                            <p
                              class="big-design-input-text my-auto p-0"
                              style="font-size: 14px"
                            >
                              {{ page.tab.backgroundColor }}
                            </p>
                            <div
                              class="rounded-circle border border-secondary"
                              style="height: 20px; aspect-ratio: 1"
                              [style.background-color]="
                                page.tab.backgroundColor
                              "
                            ></div>
                          </a>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Bar Text Color</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 px-2 mb-3">
                          <a
                            role="button"
                            class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                            [cpPosition]="'bottom'"
                            [cpPositionRelativeToArrow]="false"
                            (colorPickerSelect)="page.tab.textColor = $event"
                            [cpOutputFormat]="'hex'"
                            [cpOKButton]="true"
                            [cpOKButtonText]="'SET COLOR'"
                            [cpOKButtonClass]="'big-design-alt-button'"
                            [cpSaveClickOutside]="false"
                            [colorPicker]="page.tab.textColor"
                            style="height: 40px"
                          >
                            <p
                              class="big-design-input-text my-auto p-0"
                              style="font-size: 14px"
                            >
                              {{ page.tab.textColor }}
                            </p>
                            <div
                              class="rounded-circle border border-secondary"
                              style="height: 20px; aspect-ratio: 1"
                              [style.background-color]="page.tab.textColor"
                            ></div>
                          </a>
                        </div>
                      </div>
                    </div>

                    <div class="wrap-input1 w-100 pt-3">
                      <p class="w-100 mb-4 text">Bar Detail Color</p>
                      <div class="px-3 w-100">
                        <div class="rounded-pill border w-100 px-2 mb-3">
                          <a
                            role="button"
                            class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                            [cpPosition]="'bottom'"
                            [cpPositionRelativeToArrow]="false"
                            (colorPickerSelect)="page.tab.detailColor = $event"
                            [cpOutputFormat]="'hex'"
                            [cpOKButton]="true"
                            [cpOKButtonText]="'SET COLOR'"
                            [cpOKButtonClass]="'big-design-alt-button'"
                            [cpSaveClickOutside]="false"
                            [colorPicker]="page.tab.detailColor"
                            style="height: 40px"
                          >
                            <p
                              class="big-design-input-text my-auto p-0"
                              style="font-size: 14px"
                            >
                              {{ page.tab.detailColor }}
                            </p>
                            <div
                              class="rounded-circle border border-secondary"
                              style="height: 20px; aspect-ratio: 1"
                              [style.background-color]="page.tab.detailColor"
                            ></div>
                          </a>
                        </div>
                      </div>
                    </div>

                    <div
                      class="w-100 pt-3 pb-0 text-purple text-center fw-bold"
                    >
                      <i><span style="font-size: small">Tab Bar</span></i>
                    </div>
                  </mat-expansion-panel>

                  <mat-expansion-panel
                    class="shadow-0 border-bottom"
                    disabled
                    [expanded]="true"
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title class="fw-bold text-dark">
                        Body
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="wrap-input1 w-100 pt-3 px-0 mb-3">
                      <div
                        class="w-100"
                        cdkDropList
                        [cdkDropListData]="page.blocks ?? []"
                        (cdkDropListDropped)="drop($event, p)"
                      >
                        <ng-container
                          *ngFor="let b of page.blocks ?? []; index as i"
                        >
                          <div
                            cdkDrag
                            (click)="edit(i, p)"
                            *ngIf="
                              (activeBlock.index == i
                                ? activeBlock.block
                                : undefined) ?? b as block
                            "
                          >
                            <div
                              class="example-custom-placeholder"
                              *cdkDragPlaceholder
                            ></div>

                            <div
                              class="w-100 d-flex justify-content-between align-items-center"
                            >
                              <div class="px-3 py-2 h-100 w-100">
                                <div
                                  #col
                                  class="big-design-card h-100 shadow w-100 zoom m-0 p-0"
                                  role="button"
                                  (mouseover)="changeStyle($event, i)"
                                  (mouseout)="changeStyle($event, i)"
                                  style="position: relative; min-height: 25px"
                                  [style.background-color]="
                                    block.backgroundColor
                                  "
                                  [style.border-radius.%]="block.corners"
                                  [style.border-left-width.px]="
                                    col.clientWidth *
                                    (block.borders.left.width * 0.0005)
                                  "
                                  [style.border-right-width.px]="
                                    col.clientWidth *
                                    (block.borders.right.width * 0.0005)
                                  "
                                  [style.border-top-width.px]="
                                    col.clientWidth *
                                    (block.borders.top.width * 0.0005)
                                  "
                                  [style.border-bottom-width.px]="
                                    col.clientWidth *
                                    (block.borders.bottom.width * 0.0005)
                                  "
                                  [style.border-left-color]="
                                    block.borders.left.color
                                  "
                                  [style.border-right-color]="
                                    block.borders.right.color
                                  "
                                  [style.border-top-color]="
                                    block.borders.top.color
                                  "
                                  [style.border-bottom-color]="
                                    block.borders.bottom.color
                                  "
                                  [style.border-style]="'solid'"
                                  [style.color]="block.textColor"
                                >
                                  <!-- <div class="block">
                                <div
                                  *ngIf="
                                    (
                                      (activeBlock.index == i
                                        ? activeBlock?.block
                                        : undefined
                                      )?.text ??
                                      block.text ??
                                      ''
                                    ).trim() != ''
                                  "
                                  class="d-flex align-items-center justify-content-center"
                                  style="
                                    max-height: 50px;
                                    font-weight: bold;
                                    font-size: 4px;
                                    pointer-events: none;
                                  "
                                  style.color="{{ selectedTheme!['color'] }}"
                                >
                                  <p
                                    class="text-center text-dark"
                                    style="line-height: 1.2em"
                                    [style.font-size.px]="
                                      fontSize(
                                        (activeBlock.index == i
                                          ? activeBlock.block
                                          : undefined) ?? block
                                      )
                                    "
                                  >
                                    {{
                                      (activeBlock.index == i
                                        ? activeBlock.block
                                        : undefined
                                      )?.text ?? block.text
                                    }}
                                  </p>
                                </div>
                              </div> -->

                                  <div
                                    class="row mx-0 row-cols-1 row-cols-md-{{
                                      block.grid.rows
                                    }} justify-content-{{
                                      block.grid.alignment
                                    }}"
                                    style="pointer-events: none"
                                    *ngIf="block.type == 0"
                                    [style.padding.%]="block.grid.spacing"
                                  >
                                    <div
                                      class="col"
                                      *ngFor="
                                        let nft of block.nftList.nfts ?? []
                                      "
                                      [style.padding.%]="block.grid.spacing"
                                      #col
                                    >
                                      <div
                                        class="bg-white shadow"
                                        style="overflow: hidden"
                                        [style.border-radius.%]="
                                          block.grid.corners
                                        "
                                        [style.border-left-width.px]="
                                          col.clientWidth *
                                          (block.grid.borders.left.width * 0.01)
                                        "
                                        [style.border-right-width.px]="
                                          col.clientWidth *
                                          (block.grid.borders.right.width *
                                            0.01)
                                        "
                                        [style.border-top-width.px]="
                                          col.clientWidth *
                                          (block.grid.borders.top.width * 0.01)
                                        "
                                        [style.border-bottom-width.px]="
                                          col.clientWidth *
                                          (block.grid.borders.bottom.width *
                                            0.01)
                                        "
                                        [style.border-left-color]="
                                          block.grid.borders.left.color
                                        "
                                        [style.border-right-color]="
                                          block.grid.borders.right.color
                                        "
                                        [style.border-top-color]="
                                          block.grid.borders.top.color
                                        "
                                        [style.border-bottom-color]="
                                          block.grid.borders.bottom.color
                                        "
                                        [style.border-style]="'solid'"
                                        [style.color]="block.grid.textColor"
                                      >
                                        <div class="pb-0 w-100">
                                          <a role="button" class="w-100">
                                            <img
                                              loading="lazy"
                                              id="image"
                                              class="h-100 w-100"
                                              [useSrcset]="true"
                                              [defaultImage]="
                                                '/assets/default.png'
                                              "
                                              [lazyLoad]="
                                                nft.img != ''
                                                  ? nft.img
                                                  : '/assets/default.png'
                                              "
                                              alt="ok"
                                              style="
                                                object-fit: cover;
                                                aspect-ratio: 1;
                                              "
                                            />
                                          </a>
                                        </div>
                                      </div>
                                    </div>
                                  </div>

                                  <!-- <div
                                class="row gx-0 row-cols-{{
                                  editableLayout.type == 'desktop' &&
                                    ((activeBlock.index == i
                                      ? activeBlock.block
                                      : undefined
                                    )?.grid?.rows ?? block.grid.rows)
                                }} justify-content-center w-100 mx-0"
                                *ngIf="
                                  ((activeBlock.index == i
                                    ? activeBlock?.block
                                    : undefined
                                  )?.type ??
                                    block.type) ==
                                  1
                                "
                                style="pointer-events: none"
                              >
                                <div
                                  class="col"
                                  *ngFor="
                                    let img of (activeBlock.index == i
                                      ? activeBlock?.block
                                      : undefined
                                    )?.imgs ??
                                      block.imgs ??
                                      []
                                  "
                                  style="
                                    margin-bottom: 1px;
                                    padding-left: 0.5px;
                                    padding-right: 0.5px;
                                  "
                                >
                                  <div
                                    class="d-block align-items-center text-center text-sm-start w-100"
                                  >
                                    <a class="ms-0 me-0" role="button">
                                      <img
                                        loading="lazy"
                                        class="h-auto w-100 white"
                                        [useSrcset]="true"
                                        [defaultImage]="'/assets/default.png'"
                                        [lazyLoad]="img.link"
                                        alt="ok"
                                      />
                                    </a>
                                  </div>
                                </div>
                              </div> -->
                                  <!-- 
                              <div
                                class="row gx-0 row-cols-{{
                                  editableLayout.type == 'desktop' &&
                                    ((activeBlock.index == i
                                      ? activeBlock.block
                                      : undefined
                                    )?.grid?.rows ?? block.grid.rows)
                                }} justify-content-center w-100 mx-0"
                                *ngIf="
                                  ((activeBlock.index == i
                                    ? activeBlock.block
                                    : undefined
                                  )?.type ??
                                    block.type) ==
                                  4
                                "
                              >
                                <div
                                  class="col mb-1"
                                  *ngFor="
                                    let vid of (
                                      (activeBlock.index == i
                                        ? activeBlock?.block
                                        : undefined) ?? block
                                    ).vids ?? [];
                                    index as i
                                  "
                                >
                                  <div
                                    class="d-block align-items-center text-center text-sm-start w-100"
                                  >
                                    <a class="ms-0 me-0" role="button">
                                      <iframe
                                        [src]="vid.link | videoPipe | safeUrl"
                                        width="100%"
                                        style="aspect-ratio: 16/9"
                                      ></iframe>
                                    </a>
                                  </div>
                                </div>
                              </div> -->

                                  <!-- <div
                                class="w-100 mx-0"
                                *ngIf="
                                  ((activeBlock.index == i
                                    ? activeBlock?.block
                                    : undefined
                                  )?.type ??
                                    block.type) ==
                                  2
                                "
                                style="pointer-events: none"
                              >
                                <div
                                  class="m-1 w-100 px-0"
                                  style="
                                    text-overflow: ellipsis;
                                    line-height: 2em;
                                    font-size: 3px;
                                    word-break: break-all;
                                    padding-right: 2px;
                                  "
                                  style.color="{{ selectedTheme!['color'] }}"
                                  [innerHTML]="
                                    (
                                      (activeBlock.index == i
                                        ? activeBlock.block
                                        : undefined) ?? block
                                    ).html | safeTextRows: true
                                  "
                                ></div>
                              </div> -->

                                  <!-- <div
                                class="w-100 mx-0"
                                *ngIf="
                                  ((activeBlock.index == i
                                    ? activeBlock?.block
                                    : undefined
                                  )?.type ??
                                    block.type) ==
                                  7
                                "
                                style="pointer-events: none"
                                c
                              >
                                <h1 class="m-2 text-center fw-bolder">
                                  CUSTOM HTML
                                </h1>
                              </div> -->

                                  <!-- <div
                                class="w-100 h-100"
                                style="
                                  position: absolute;
                                  pointer-events: all;
                                  cursor: grab;
                                "
                              ></div> -->
                                </div>
                              </div>
                            </div>
                          </div>
                        </ng-container>
                      </div>

                      <div
                        class="w-100 d-flex justify-content-between align-items-center"
                      >
                        <div class="mt-1 px-3 w-100">
                          <div
                            class="card zoom container-fluid d-flex justify-content-center align-items-center big-design-placeholder mt-1"
                            role="button"
                            (click)="addBlock(p)"
                            matTooltip="Add New Content Block"
                          >
                            <a
                              class="fw-bolder text-purple d-flex align-items-center justify-content-center"
                              style="font-size: large; text-decoration: none"
                            >
                              ADD BLOCK
                              <mat-icon
                                class="ms-1"
                                style="font-weight: bolder"
                                [inline]="true"
                                >add</mat-icon
                              >
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div
                      class="w-100 pt-3 pb-0 text-purple text-center fw-bold"
                    >
                      <i><span style="font-size: small">Body</span></i>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div
                *ngIf="editingBlock != undefined && activeBlock.block"
                class="w-100 h-100"
                style="overflow-y: scroll"
              >
                <div
                  class="wrap-input1 w-100 py-2 px-3 d-flex justify-content-between align-content-center"
                >
                  <a
                    role="button"
                    (click)="finishedEditing(3)"
                    class="text-purple fw-bold p-0 my-auto"
                  >
                    <mat-icon> close </mat-icon>
                  </a>

                  <a
                    role="button"
                    (click)="finishedEditing(0)"
                    class="btn bg-purple rounded-pill text-white text fw-bold px-3 py-1 my-auto"
                  >
                    Save
                  </a>
                </div>

                <mat-expansion-panel
                  class="shadow-0 border-bottom"
                  [expanded]="true"
                >
                  <mat-expansion-panel-header>
                    <mat-panel-title class="fw-bold text-dark">
                      General
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div class="wrap-input1 w-100 pt-3">
                    <p class="w-100 mb-4 text">Block Type</p>
                    <div class="px-3 w-100">
                      <div class="rounded-pill border w-100 pe-4 mb-3">
                        <mat-form-field
                          class="w-100 text"
                          appearance="legacy"
                          floatLabel="never"
                        >
                          <mat-select
                            [(ngModel)]="activeBlock.block.type"
                            (selectionChange)="changed(undefined, $event)"
                            class="my-auto d-flex justify-content-start align-items-center"
                          >
                            <mat-select-trigger
                              class="text-dark h-100 m-auto"
                              *ngIf="matchingType(activeBlock.block.type ?? 0)"
                            >
                              <div
                                class="w-100 d-flex justify-content-start align-items-center p-3 my-auto"
                              >
                                <div style="height: 40px"></div>
                                <div class="text-start text-truncate w-50 ms-2">
                                  {{
                                    matchingType(activeBlock.block.type)!.name
                                  }}
                                </div>
                              </div>
                            </mat-select-trigger>

                            <mat-option
                              *ngFor="let type of types ?? []"
                              [value]="type.code"
                            >
                              <div
                                class="h-100 w-100 d-flex justify-content-start justify-content-md-between align-items-center py-3"
                              >
                                <div
                                  class="d-flex justify-content-start align-items-center"
                                >
                                  <span class="py-1" style="font-size: medium">
                                    {{ type?.name ?? "Choose a block type" }}
                                  </span>
                                </div>
                              </div>
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>

                  <div class="wrap-input1 w-100 pt-3">
                    <p class="w-100 mb-4 text">Background Color</p>
                    <div class="px-3 w-100">
                      <div class="rounded-pill border w-100 px-2 mb-3">
                        <a
                          role="button"
                          class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                          [cpPosition]="'bottom'"
                          [cpPositionRelativeToArrow]="false"
                          (colorPickerSelect)="
                            activeBlock.block.backgroundColor = $event
                          "
                          [cpOutputFormat]="'hex'"
                          [cpOKButton]="true"
                          [cpOKButtonText]="'SET COLOR'"
                          [cpOKButtonClass]="'big-design-alt-button'"
                          [cpSaveClickOutside]="false"
                          [colorPicker]="
                            activeBlock.block.backgroundColor &&
                            activeBlock.block.backgroundColor != ''
                              ? activeBlock.block.backgroundColor
                              : page.backgroundColor ?? '#FFFFFF'
                          "
                          style="height: 40px"
                        >
                          <p
                            class="big-design-input-text my-auto p-0"
                            style="font-size: 14px"
                          >
                            {{
                              activeBlock.block.backgroundColor &&
                              activeBlock.block.backgroundColor != ""
                                ? activeBlock.block.backgroundColor
                                : page.backgroundColor ?? "#FFFFFF"
                            }}
                          </p>
                          <div
                            class="rounded-circle border border-secondary"
                            style="height: 20px; aspect-ratio: 1"
                            [style.background-color]="
                              activeBlock.block.backgroundColor &&
                              activeBlock.block.backgroundColor != ''
                                ? activeBlock.block.backgroundColor
                                : page.backgroundColor ?? '#FFFFFF'
                            "
                          ></div>
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="wrap-input1 w-100 pt-3">
                    <p class="w-100 mb-4 text">Corner Radius</p>
                    <div class="px-3 w-100">
                      <div class="w-100 mb-3">
                        <ngx-slider
                          [(value)]="activeBlock.block.corners"
                          [options]="blockBorderRadiusOptions"
                        ></ngx-slider>
                      </div>
                    </div>
                  </div>

                  <div class="w-100 pt-3 pb-0 text-purple text-center fw-bold">
                    <i><span style="font-size: small">General</span></i>
                  </div>
                </mat-expansion-panel>

                <mat-expansion-panel class="shadow-0 border-bottom">
                  <mat-expansion-panel-header>
                    <mat-panel-title class="fw-bold text-dark">
                      Block Margins
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div
                    class="wrap-input1 w-100 pt-3"
                    *ngFor="let margin of margins"
                  >
                    <p class="w-100 mb-4 text">
                      Margin {{ margin.id | titlecase }}
                    </p>
                    <div class="px-3 w-100">
                      <div class="w-100 mb-3">
                        <ngx-slider
                          [(value)]="activeBlock.block.padding![margin.id]"
                          [options]="margin.options"
                        ></ngx-slider>
                      </div>
                    </div>
                  </div>

                  <div class="w-100 pt-3 pb-0 text-purple text-center fw-bold">
                    <i><span style="font-size: small">Block Margins</span></i>
                  </div>
                </mat-expansion-panel>

                <!-- <div
                  *ngIf="rowForm.controls.type.value == 2"
                  [ngxSummernote]="config"
                  formControlName="htmlText"
                ></div> -->

                <!-- <div
                  class="w-100"
                  *ngIf="(activeBlock.block?.type ?? 0) == 7"
                  [class.relative]="codeMode == false"
                  style="height: 450px"
                >
                  <ngx-monaco-editor
                    class="w-100 h-100"
                    [class.absolute]="codeMode"
                    ngDefaultControl
                    [options]="editorOptions"
                    [(ngModel)]="activeBlock.block!.html"
                  >
                  </ngx-monaco-editor>

                  <a [hidden]='codeMode' (click)='codeMode = true' style="position: absolute; bottom: 15px; right: 5px; z-index: 100; height: 30px; width: 30px; text-decoration: none;" role="button" class="btn btn-light shadow rounded-circle d-flex justify-content-center align-items-center"><mat-icon >fullscreen</mat-icon></a>
                </div> -->

                <mat-expansion-panel class="shadow-0 border-bottom">
                  <mat-expansion-panel-header>
                    <mat-panel-title class="fw-bold text-dark">
                      Grid Layout
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div class="wrap-input1 w-100 pt-3">
                    <p class="w-100 mb-4 text">Layout</p>
                    <div class="px-3 w-100">
                      <div class="rounded-pill border w-100 pe-4 mb-3">
                        <mat-form-field
                          class="w-100 text"
                          appearance="legacy"
                          floatLabel="never"
                        >
                          <mat-select
                            [(ngModel)]="activeBlock.block.grid!.rows"
                            (selectionChange)="changed($event)"
                            class="my-auto d-flex justify-content-start align-items-center"
                          >
                            <mat-select-trigger
                              class="text-dark h-100 m-auto"
                              *ngIf="activeBlock.block?.grid?.rows ?? 3"
                            >
                              <div
                                class="w-100 d-flex justify-content-start align-items-center p-3 my-auto"
                              >
                                <div style="height: 40px"></div>
                                <div class="text-start text-truncate w-50 ms-2">
                                  {{ activeBlock.block.grid.rows }}
                                  Item(s) Per. Row
                                </div>
                              </div>
                            </mat-select-trigger>

                            <mat-option
                              *ngFor="let g of grid ?? []"
                              [value]="g.block"
                            >
                              <div
                                class="h-100 w-100 d-flex justify-content-start justify-content-md-between align-items-center py-3"
                              >
                                <div
                                  class="d-flex justify-content-start align-items-center"
                                >
                                  <span class="py-1" style="font-size: medium">
                                    {{ g.name }} Per. Row
                                  </span>
                                </div>
                              </div>
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>

                  <div class="wrap-input1 w-100 pt-3">
                    <p class="w-100 mb-4 text">Alignment</p>
                    <div class="px-3 w-100">
                      <div class="rounded-pill border w-100 pe-4 mb-3">
                        <mat-form-field
                          class="w-100 text"
                          appearance="legacy"
                          floatLabel="never"
                        >
                          <mat-select
                            [(ngModel)]="activeBlock.block.grid!.alignment"
                            (selectionChange)="changed($event)"
                            class="my-auto d-flex justify-content-start align-items-center"
                          >
                            <mat-select-trigger
                              class="text-dark h-100 m-auto"
                              *ngIf="
                                activeBlock.block?.grid?.alignment ?? 'start'
                              "
                            >
                              <div
                                class="w-100 d-flex justify-content-start align-items-center p-3 my-auto"
                              >
                                <div style="height: 40px"></div>
                                <div class="text-start text-truncate w-50 ms-2">
                                  {{
                                    alignment(activeBlock.block.grid.alignment)
                                      ?.name ?? "Select Alignment"
                                  }}
                                </div>
                              </div>
                            </mat-select-trigger>

                            <mat-option
                              *ngFor="let g of gridAlignment ?? []"
                              [value]="g.id"
                            >
                              <div
                                class="h-100 w-100 d-flex justify-content-start justify-content-md-between align-items-center py-3"
                              >
                                <div
                                  class="d-flex justify-content-start align-items-center"
                                >
                                  <span class="py-1" style="font-size: medium">
                                    {{ g.name }}
                                  </span>
                                </div>
                              </div>
                            </mat-option>
                          </mat-select>
                        </mat-form-field>
                      </div>
                    </div>
                  </div>

                  <div class="wrap-input1 w-100 pt-3">
                    <p class="w-100 mb-4 text">Spacing</p>
                    <div class="px-3 w-100">
                      <div class="w-100 mb-3">
                        <ngx-slider
                          [(value)]="activeBlock.block.grid.spacing"
                          [options]="options"
                        ></ngx-slider>
                      </div>
                    </div>
                  </div>

                  <div class="wrap-input1 w-100 pt-3">
                    <p class="w-100 mb-4 text">Corners</p>
                    <div class="px-3 w-100">
                      <div class="w-100 mb-3">
                        <ngx-slider
                          [(value)]="activeBlock.block.grid.corners"
                          [options]="blockGridBorderRadiusOptions"
                        ></ngx-slider>
                      </div>
                    </div>
                  </div>

                  <div class="w-100 pt-3 pb-0 text-purple text-center fw-bold">
                    <i><span style="font-size: small">Grid Layout</span></i>
                  </div>
                </mat-expansion-panel>

                <mat-expansion-panel class="shadow-0 border-bottom">
                  <mat-expansion-panel-header>
                    <mat-panel-title class="fw-bold text-dark">
                      Item Borders
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <ng-container *ngFor="let border of gridBorders">
                    <div class="w-100 py-4">
                      <div class="wrap-input1 w-100">
                        <p class="w-100 mb-4 text">
                          Border {{ border.id | titlecase }} Width
                        </p>
                        <div class="px-3 w-100">
                          <div class="w-100 mb-3">
                            <ngx-slider
                              [(value)]="
                                activeBlock.block.grid.borders[border.id].width
                              "
                              [options]="border.options"
                            ></ngx-slider>
                          </div>
                        </div>
                      </div>

                      <div class="wrap-input1 w-100 pt-3">
                        <p class="w-100 mb-4 text">
                          Border {{ border.id | titlecase }} Color
                        </p>
                        <div class="px-3 w-100">
                          <div class="rounded-pill border w-100 px-2 mb-3">
                            <a
                              role="button"
                              class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                              [cpPosition]="'bottom'"
                              [cpPositionRelativeToArrow]="false"
                              (colorPickerSelect)="
                                activeBlock.block.grid.borders[
                                  border.id
                                ].color = $event
                              "
                              [cpOutputFormat]="'hex'"
                              [cpOKButton]="true"
                              [cpOKButtonText]="'SET COLOR'"
                              [cpOKButtonClass]="'big-design-alt-button'"
                              [cpSaveClickOutside]="false"
                              [colorPicker]="
                                activeBlock.block.grid.borders[border.id].color
                              "
                              style="height: 40px"
                            >
                              <p
                                class="big-design-input-text my-auto p-0"
                                style="font-size: 14px"
                              >
                                {{
                                  activeBlock.block.grid.borders[border.id]
                                    .color
                                }}
                              </p>
                              <div
                                class="rounded-circle border border-secondary"
                                style="height: 20px; aspect-ratio: 1"
                                [style.background-color]="
                                  activeBlock.block.grid.borders[border.id]
                                    .color
                                "
                              ></div>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                  <div class="w-100 pt-3 pb-0 text-purple text-center fw-bold">
                    <i><span style="font-size: small">Item Borders</span></i>
                  </div>
                </mat-expansion-panel>

                <mat-expansion-panel class="shadow-0 border-bottom">
                  <mat-expansion-panel-header>
                    <mat-panel-title class="fw-bold text-dark">
                      Block Borders
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <ng-container *ngFor="let border of borders">
                    <div class="w-100 py-4">
                      <div class="wrap-input1 w-100">
                        <p class="w-100 mb-4 text">
                          Border {{ border.id | titlecase }} Width
                        </p>
                        <div class="px-3 w-100">
                          <div class="w-100 mb-3">
                            <ngx-slider
                              [(value)]="
                                activeBlock.block.borders[border.id].width
                              "
                              [options]="border.options"
                            ></ngx-slider>
                          </div>
                        </div>
                      </div>

                      <div class="wrap-input1 w-100 pt-3">
                        <p class="w-100 mb-4 text">
                          Border {{ border.id | titlecase }} Color
                        </p>
                        <div class="px-3 w-100">
                          <div class="rounded-pill border w-100 px-2 mb-3">
                            <a
                              role="button"
                              class="btn btn-transparent shadow-0 d-flex justify-content-between align-items-center"
                              [cpPosition]="'bottom'"
                              [cpPositionRelativeToArrow]="false"
                              (colorPickerSelect)="
                                activeBlock.block.borders[border.id].color =
                                  $event
                              "
                              [cpOutputFormat]="'hex'"
                              [cpOKButton]="true"
                              [cpOKButtonText]="'SET COLOR'"
                              [cpOKButtonClass]="'big-design-alt-button'"
                              [cpSaveClickOutside]="false"
                              [colorPicker]="
                                activeBlock.block.borders[border.id].color
                              "
                              style="height: 40px"
                            >
                              <p
                                class="big-design-input-text my-auto p-0"
                                style="font-size: 14px"
                              >
                                {{ activeBlock.block.borders[border.id].color }}
                              </p>
                              <div
                                class="rounded-circle border border-secondary"
                                style="height: 20px; aspect-ratio: 1"
                                [style.background-color]="
                                  activeBlock.block.borders[border.id].color
                                "
                              ></div>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                  <div class="w-100 pt-3 pb-0 text-purple text-center fw-bold">
                    <i><span style="font-size: small">Block Borders</span></i>
                  </div>
                </mat-expansion-panel>

                <!-- <div
                  cdkDropList
                  class="rounded shadow bg-light w-100 h-100"
                  (cdkDropListDropped)="drop($event, p, true)"
                  style="overflow-y: scroll"
                  *ngIf="(activeBlock.block?.type ?? 0) == 1"
                >
                  <div
                    class="example-box"
                    *ngFor="let image of images"
                    cdkDrag
                    [cdkDragDisabled]="!image.isActive"
                  >
                    <div class="h-100 w-100 p-1" style="position: relative">
                      <a
                        *ngIf="image.isActive"
                        role="button"
                        (click)="fileInput.click()"
                      >
                        <img
                          loading="lazy"
                          class="ani-style w-100 white"
                          [useSrcset]="true"
                          [defaultImage]="'/assets/default.png'"
                          [lazyLoad]="image.img"
                          style="object-fit: contain"
                          alt="ok"
                        />
                      </a>

                      <div style="position: absolute; top: 0; right: 0">
                        <a
                          *ngIf="image.isActive && canCancel()"
                          class="ani-style"
                          (click)="removeImg(image)"
                          role="button"
                          ><mat-icon>cancel</mat-icon></a
                        >
                      </div>

                      <div
                        *ngIf="!image.isActive"
                        class="cdk-drag-placeholder w-100"
                        style="height: 100px"
                      >
                        <a
                          class="h-100 w-100 d-flex ani-style justify-content-center align-items-center"
                          (click)="fileInput.click()"
                          style="text-decoration: none"
                          role="button"
                        >
                          <mat-icon>add_circle</mat-icon>
                        </a>
                      </div>
                      <mat-form-field class="w-100 my-1" floatLabel="never">
                        <input
                          type="text"
                          matInput
                          [ngModelOptions]="{ standalone: true }"
                          [(ngModel)]="image.link"
                          style="font-size: small"
                          placeholder="Image Click URL"
                          class="text-dark big-design-input-text"
                        />
                        <mat-icon role="button" matSuffix>link</mat-icon>
                      </mat-form-field>
                      <input
                        #fileInput
                        type="file"
                        (change)="fileChangeEvent($event, image)"
                        style="display: none"
                      />
                    </div>
                  </div>
                </div> -->

                <!-- <div
                  cdkDropList
                  class="rounded shadow bg-light w-100 h-100"
                  (cdkDropListDropped)="drop($event, p, true)"
                  style="overflow-y: scroll"
                  *ngIf="(activeBlock.block?.type ?? 0) == 4"
                >
                  <div
                    class="example-box"
                    *ngFor="let vid of videos"
                    cdkDrag
                    [cdkDragDisabled]="!vid.isActive"
                  >
                    <div class="h-100 w-100 p-1" style="position: relative">
                      <a class="ms-0 me-0" role="button" *ngIf="vid.isActive">
                        <iframe
                          [src]="vid.link | videoPipe | safeUrl"
                          width="100%"
                          style="aspect-ratio: 16/9"
                        ></iframe>
                      </a>

                      <div style="position: absolute; top: 0; right: 0">
                        <a *ngIf="vid.isActive" class="ani-style" role="button"
                          ><mat-icon>cancel</mat-icon></a
                        >
                      </div>

                      <div
                        *ngIf="!vid.isActive"
                        class="cdk-drag-placeholder w-100 m-0"
                        style="aspect-ratio: 16/9"
                      >
                        <a
                          class="h-100 w-100 d-flex ani-style justify-content-center align-items-center"
                          style="text-decoration: none"
                          role="button"
                        >
                          No Video Set
                        </a>
                      </div>
                      <mat-form-field class="w-100 my-1" floatLabel="never">
                        <input
                          type="text"
                          matInput
                          [ngModelOptions]="{ standalone: true }"
                          [(ngModel)]="vid.link"
                          (keyup)="vidChangeEvent($event, vid)"
                          style="font-size: small"
                          placeholder="Video URL"
                          class="text-dark big-design-input-text"
                        />
                        <mat-icon role="button" matSuffix>link</mat-icon>
                      </mat-form-field>
                    </div>
                  </div>
                </div> -->

                <mat-expansion-panel class="shadow-0 border-bottom">
                  <mat-expansion-panel-header>
                    <mat-panel-title class="fw-bold text-dark">
                      {{ matchingType(activeBlock.block.type)!.name }}
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <div
                    class="wrap-input1 w-100 pt-3"
                    *ngIf="activeBlock.block?.type == 0"
                  >
                    <p class="w-100 mb-4 text">Displayed NFTs</p>
                    <div class="px-3 w-100 mb-3">
                      <app-nft-table
                        #nftTable
                        [nfts]="activeBlock.block.nftList.nfts ?? []"
                        [count]="(activeBlock.block.nftList.nfts ?? []).length"
                        (clicked)="openNFT($event?.nft, $event?.index)"
                      >
                      </app-nft-table>
                    </div>
                  </div>
                  <div class="w-100 pt-3 pb-0 text-purple text-center fw-bold">
                    <i
                      ><span style="font-size: small"
                        >{{ matchingType(activeBlock.block.type)!.name }}
                      </span></i
                    >
                  </div>
                </mat-expansion-panel>

                <div
                  class="px-3 d-flex justify-content-center align-content-center py-4"
                >
                  <a
                    role="button"
                    (click)="finishedEditing(1)"
                    class="btn bg-danger rounded-pill text-white fw-bold px-3 py-1 my-auto"
                  >
                    Delete Block
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          class="w-100 w-md-{{
            editable ? '80' : '100'
          }} h-100 d-flex justify-content-center align-content-center bg-light"
        >
          <div
            class="big-design-card m-auto {{
              editable
                ? 'shadow border border-1 border-dark'
                : 'shadow-0 border-preview'
            }} {{
              editable ? editableLayout.type + '-full' : editableLayout.type
            }} p-0 d-flex justify-content-between align-content-center flex-column{{
              page.position == 0 ? '' : '-reverse'
            }}"
            role="button"
            (click)="editable ? null : clickedCanvas.emit(true)"
            style="overflow: hidden"
          >
            <div
              *ngIf="page.bar.visible"
              class="w-100 shadow"
              [style.background-color]="page.bar.backgroundColor"
              [style.border-style]="'solid'"
              [style.color]="page.bar.detailColor"
              [style.border-color]="page.bar.detailColor"
              [style.border-top-width.px]="page.position == 1 ? 1 : 0"
              [style.border-bottom-width.px]="page.position == 0 ? 1 : 0"
              [style.border-left-width.px]="0"
              [style.border-right-width.px]="0"
              [style.height.px]="100"
            ></div>

            <div
              class="w-100 h-100 big-design-body p-0"
              style="overflow-y: scroll"
              id="capture"
              #mainFrame
              [style.pointer-events]="editable ? 'all' : 'none'"
              [style.background-color]="page.backgroundColor"
            >
              <section class="py-0 w-100 mb-0">
                <div
                  cdkDropList
                  class="ms-0 mb-0 h-100"
                  (cdkDropListDropped)="drop($event, p)"
                >
                  <ng-container *ngFor="let b of page.blocks ?? []; index as i">
                    <div
                      class="block"
                      *ngIf="
                        (activeBlock.index == i
                          ? activeBlock.block
                          : undefined) ?? b as block
                      "
                      id="p-{{ i }}"
                      #col
                      cdkDrag
                      role="button"
                      (click)="edit(i, p)"
                      [class.big-design-editor]="activeBlock.index == i"
                      [class.highlight]="
                        hoverIndex != undefined && hoverIndex == i
                      "
                      [style.padding-top.px]="block.padding.top * 10"
                      [style.padding-right.px]="block.padding.right * 10"
                      [style.padding-bottom.px]="block.padding.bottom * 10"
                      [style.padding-left.px]="block.padding.left * 10"
                    >
                      <div
                        class="p-0 w-100"
                        style="overflow: hidden"
                        [style.background-color]="block.backgroundColor"
                        [style.border-radius.%]="block.grid.corners"
                        [style.border-left-width.px]="
                          col.clientWidth * (block.borders.left.width * 0.0005)
                        "
                        [style.border-right-width.px]="
                          col.clientWidth * (block.borders.right.width * 0.0005)
                        "
                        [style.border-top-width.px]="
                          col.clientWidth * (block.borders.top.width * 0.0005)
                        "
                        [style.border-bottom-width.px]="
                          col.clientWidth *
                          (block.borders.bottom.width * 0.0005)
                        "
                        [style.border-left-color]="block.borders.left.color"
                        [style.border-right-color]="block.borders.right.color"
                        [style.border-top-color]="block.borders.top.color"
                        [style.border-bottom-color]="block.borders.bottom.color"
                        [style.border-style]="'solid'"
                        [style.color]="block.textColor"
                        [style.border-radius.%]="block.corners"
                      >
                        <!-- <div
                    *ngIf="
                      ((activeBlock.index == i ? activeBlock?.block : undefined)
                        ?.text ??
                        block.text ??
                        '') !=
                      ''
                    "
                    class="d-flex align-items-center justify-content-center py-2 m-0"
                    style="height: 50px; font-weight: bold; font-size: 30px"
                    style.color="{{ selectedTheme!['color'] }}"
                  >
                    <p
                      class="text-center text-dark"
                      style="line-height: 1.2em"
                    >
                      {{
                        (activeBlock.index == i ? activeBlock.block : undefined)
                          ?.text ?? block.text
                      }}
                    </p>
                  </div> -->
                        <div class="w-100" *ngIf="block.type == 0">
                          <div
                            class="row mx-0 row-cols-1 row-cols-md-{{
                              block.grid.rows
                            }} justify-content-{{ block.grid.alignment }}"
                            style="pointer-events: none"
                            [style.padding.%]="block.grid.spacing"
                          >
                            <div
                              class="col"
                              *ngFor="let nft of block.nftList.nfts ?? []"
                              [style.padding.%]="block.grid.spacing"
                              #col
                            >
                              <div
                                class="bg-white shadow"
                                style="overflow: hidden"
                                [style.border-radius.%]="block.grid.corners"
                                [style.border-left-width.px]="
                                  col.clientWidth *
                                  (block.grid.borders.left.width * 0.01)
                                "
                                [style.border-right-width.px]="
                                  col.clientWidth *
                                  (block.grid.borders.right.width * 0.01)
                                "
                                [style.border-top-width.px]="
                                  col.clientWidth *
                                  (block.grid.borders.top.width * 0.01)
                                "
                                [style.border-bottom-width.px]="
                                  col.clientWidth *
                                  (block.grid.borders.bottom.width * 0.01)
                                "
                                [style.border-left-color]="
                                  block.grid.borders.left.color
                                "
                                [style.border-right-color]="
                                  block.grid.borders.right.color
                                "
                                [style.border-top-color]="
                                  block.grid.borders.top.color
                                "
                                [style.border-bottom-color]="
                                  block.grid.borders.bottom.color
                                "
                                [style.border-style]="'solid'"
                                [style.color]="block.grid.textColor"
                              >
                                <div class="p-0 w-100">
                                  <img
                                    loading="lazy"
                                    id="image"
                                    class="h-100 w-100"
                                    [useSrcset]="true"
                                    [defaultImage]="'/assets/default.png'"
                                    [lazyLoad]="
                                      nft.img != ''
                                        ? nft.img
                                        : '/assets/default.png'
                                    "
                                    alt="ok"
                                    style="object-fit: cover; aspect-ratio: 1"
                                  />
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- <div
                      class="row gx-0 row-cols-{{
                        editableLayout.type == 'desktop' &&
                          ((activeBlock.index == i
                            ? activeBlock.block
                            : undefined
                          )?.grid?.rows ?? block.grid.rows)
                      }} justify-content-center w-100 mx-0"
                      *ngIf="
                        ((activeBlock.index == i
                          ? activeBlock?.block
                          : undefined
                        )?.type ??
                          block.type) ==
                        1
                      "
                      style="pointer-events: none"
                    >
                      <div
                        class="col"
                        style="margin-bottom: 2px"
                        *ngFor="
                          let img of (activeBlock.index == i
                            ? activeBlock?.block
                            : undefined
                          )?.imgs ??
                            block.imgs ??
                            []
                        "
                      >
                        <div
                          class="d-block align-items-center text-center text-sm-start w-100"
                        >
                          <a class="mx-0" role="button">
                            <img
                              class="h-auto w-100"
                              style="object-fit: contain"
                              [src]="img"
                              alt="ok"
                            />
                          </a>
                        </div>
                      </div>
                    </div> -->

                        <!-- <div
                      class="row gx-0 row-cols-{{
                        editableLayout.type == 'desktop' &&
                          ((activeBlock.index == i
                            ? activeBlock.block
                            : undefined
                          )?.grid?.rows ?? block.grid.rows)
                      }} justify-content-center w-100 px-3 mb-1"
                      *ngIf="
                        ((activeBlock.index == i
                          ? activeBlock?.block
                          : undefined
                        )?.type ??
                          block.type) ==
                        3
                      "
                      style="pointer-events: none"
                    ></div> -->

                        <!-- <div
                      class="row gx-0 row-cols-{{
                        editableLayout.type == 'desktop' &&
                          ((activeBlock.index == i
                            ? activeBlock.block
                            : undefined
                          )?.grid?.rows ?? block.grid.rows)
                      }} justify-content-center w-100 mx-0"
                      *ngIf="
                        ((activeBlock.index == i
                          ? activeBlock?.block
                          : undefined
                        )?.type ??
                          block.type) ==
                        4
                      "
                    >
                      <div
                        class="col mb-1"
                        *ngFor="
                          let vid of (
                            (activeBlock.index == i
                              ? activeBlock?.block
                              : undefined) ?? block
                          ).vids ?? [];
                          index as i
                        "
                      >
                        <div
                          class="d-block align-items-center text-center text-sm-start w-100"
                        >
                          <a class="ms-0 me-0" role="button">
                            <iframe
                              [src]="vid.link | videoPipe | safeUrl"
                              width="100%"
                              style="aspect-ratio: 16/9"
                            ></iframe>
                          </a>
                        </div>
                      </div>
                    </div> -->

                        <!-- <div
                      class="w-100 mx-0"
                      *ngIf="
                        ((activeBlock.index == i
                          ? activeBlock?.block
                          : undefined
                        )?.type ??
                          block.type) ==
                        2
                      "
                      style="pointer-events: none"
                    >
                      <div
                        class="p-3 h-100"
                        style.color="{{ selectedTheme!['color'] }}"
                        [innerHTML]="
                          (
                            (activeBlock.index == i
                              ? activeBlock.block
                              : undefined) ?? block
                          ).html | safeTextRows
                        "
                      ></div>
                    </div> -->

                        <!-- <div
                      class="w-100 mx-0"
                      id="c{{ i }}"
                      *ngIf="
                        (
                          (activeBlock.index == i
                            ? activeBlock?.block
                            : undefined) ?? block
                        ).type == 7
                      "
                      style="pointer-events: none"
                    >
                      <iframe
                        width="100%"
                        id="frame{{ i }}"
                        height="100%"
                        (load)="resizeIframe(i)"
                        [srcdoc]="
                          (
                            (activeBlock.index == i
                              ? activeBlock.block
                              : undefined) ?? block
                          ).htmlTemplate | safeHtml
                        "
                      ></iframe>
                    </div> -->
                      </div>
                    </div>
                  </ng-container>
                </div>
              </section>
            </div>

            <div
              class="w-100 shadow"
              [style.background-color]="page.tab.backgroundColor"
              [style.border-style]="'solid'"
              [style.color]="page.tab.detailColor"
              [style.border-color]="page.tab.detailColor"
              [style.border-top-width.px]="page.position == 0 ? 1 : 0"
              [style.border-bottom-width.px]="page.position == 1 ? 1 : 0"
              [style.border-left-width.px]="0"
              [style.border-right-width.px]="0"
              [style.height.px]="75"
            >
              <div
                class="w-100 h-100 row row-cols-{{
                  editableLayout.pages.length
                }} gx-0 justify-content-center"
              >
                <div
                  *ngFor="
                    let page2 of editableLayout.pages ?? [];
                    index as tabIndex
                  "
                  class="col h-100 px-{{
                    tabIndex != 0 && tabIndex != editableLayout.pages.length - 1
                      ? 'bar'
                      : '0'
                  }}"
                  [style.background-color]="page.tab.detailColor"
                  (click)="tabGroup.selectedIndex = tabIndex"
                >
                  <div
                    class="d-flex justify-content-center align-items-center flex-column fw-bold h-100"
                    [style.background-color]="page.tab.backgroundColor"
                    [style.color]="
                      tabGroup.selectedIndex == tabIndex
                        ? (page.tab.textColor | colorShade: 50)
                        : page.tab.textColor
                    "
                    style="font-size: 12px"
                  >
                    <mat-icon> {{ page2.icon }} </mat-icon>
                    {{ page2.title }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>

    <mat-tab disabled *ngIf="editable">
      <ng-template mat-tab-label>
        <div class="d-flex justify-content-start align-items-center w-100">
          <button
            (click)="onAddChildControl($event)"
            class="text-purple fw-bolder"
            mat-icon-button
          >
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>
