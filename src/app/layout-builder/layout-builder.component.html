<div
  *ngIf="editableLayout"
  class="bg-light p-0 {{
    editable ? 'big-design-card rounded-15 shadow w-100 h-100' : 'vh-75 vw-50'
  }}"
  style="overflow: hidden"
>
  <mat-tab-group
    class="{{ editable ? 'w-100 h-100' : 'vh-75' }} remove-border-bottom"
    animationDuration="0"
    #tabGroup
    [color]="color"
  >
    <mat-tab
      class="py-0 w-100"
      *ngFor="
        let page of editableLayout.pages ?? [];
        index as p;
        trackBy: trackByIndex
      "
    >
      <ng-template mat-tab-label>
        <div
          (cdkDropListDropped)="onDropTab($event)"
          [cdkDropListConnectedTo]="(childMenuIds$ | async)!"
          [cdkDropListData]="editableLayout.pages"
          [id]="CHILD_ID_NAME + p"
          [cdkDropListOrientation]="'horizontal'"
          class="w-100 child-menu-drop-list"
          cdkDropList
          *ngIf="editable"
        >
          <div
            (cdkDragEntered)="onDragEntered($event)"
            (cdkDragExited)="onDragExited($event)"
            class="d-flex align-items-center bg-light ps-2 rounded fw-bold zoom"
            cdkDrag
            style="font-size: small"
          >
            <div *cdkDragPlaceholder class="drag-custom-placeholder"></div>
            <div
              class="drag-wrapper d-flex w-100 justify-content-between align-content-center p-1"
            >
              <div class="d-flex align-items-center">
                <span>{{ page.title }}</span>
              </div>

              <div class="d-flex justify-content-between align-content-center">
                <button
                  (click)="onRemoveMenu($event, p)"
                  [disabled]="editableLayout.pages.length === 1"
                  class="text-purple fw-bolder"
                  mat-icon-button
                >
                  <mat-icon class="text">clear</mat-icon>
                </button>
                <div
                  class="bg-light-gray my-auto"
                  style="width: 1px; height: 60%"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
      <div
        class="w-100 h-100 d-block d-md-flex justify-content-between align-items-top border-{{
          editable ? 'top' : 'none'
        }} position-{{ openBar ? 'static' : 'relative' }}"
      >
        <!-- ADD SIDEBAR HERE-->

        <div
          class="d-none d-md-block w-100 w-md-20 h-100 big-design-card rounded-0 bg-white shadow-0 p-0 border-end"
          *ngIf="editable && openBar"
        >
          <app-layout-sidebar
            [page]="page"
            [pages]="editableLayout.pages ?? []"
            [pageIndex]="p"
            [walletId]="wallet.id"
            [overrideBlock]="activeBlock"
            (saveLayouts)="
              saveLayout($event.delay)
            "
            (droppedPage)="drop($event.$event, $event.pageIndex)"
            (closeBar)="openBar = false"
            (edit)="edit($event.blockIndex, $event.pageIndex)"
          >
          </app-layout-sidebar>
        </div>

        <div
          class="h-100 d-flex justify-content-center align-items-center px-0 h-100 bg-white border-end position-{{
            openBar ? 'static' : 'absolute'
          }}"
          *ngIf="editable && !openBar"
          style="z-index: 500"
        >
          <div
            class="my-auto p-2 text-secondary"
            role="button"
            (click)="openBar = true"
          >
            <mat-icon> arrow_forward_ios </mat-icon>
          </div>
        </div>

        <div
          class="w-100 w-md-{{
            editable && openBar ? '80' : '100'
          }} h-100 d-flex justify-content-center align-items-center bg-light position-{{
            openBar ? 'static' : 'absolute'
          }}"
        >
          <div
            class="rounded-15 {{
              editable
                ? 'shadow border border-1 border-dark'
                : 'shadow-0 border-preview'
            }} m-auto {{
              editable ? editableLayout.type + '-full' : editableLayout.type
            }} p-0"
            style="overflow: hidden"
          >
            <app-page
              [editable]="editable"
              [layout]="editableLayout"
              [overrideBlock]="activeBlock"
              [currentPage]="{page, index: p}"
              (clickedLayout)="clickedCanvas.emit(true)"
              (updatePages)="updatePages($event)"
              (updateBlocks)="drop($event, p)"
              (pageChanged)="tabGroup.selectedIndex = $event"
              (edit)="edit($event.blockIndex, $event.pageIndex)"
            >
            </app-page>
          </div>
        </div>
      </div>
    </mat-tab>

    <mat-tab disabled *ngIf="editable">
      <ng-template mat-tab-label>
        <div class="d-flex justify-content-start align-items-center w-100">
          <button
            (click)="onAddChildControl($event)"
            class="text-purple fw-bolder"
            mat-icon-button
          >
            <mat-icon>add</mat-icon>
          </button>
        </div>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>
